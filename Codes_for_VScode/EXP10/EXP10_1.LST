 The Microsoft MACRO Assembler , Version 1.27          	Page	1-1
	 	 	 	 	 	 	 	04-29-<4    


 0000	 	 	 	STACK   SEGMENT
 0000  0200 [	 	 	        STK  DW 200H DUP(?)
                ????	 	
                      ]	 	
 	 	 	 	
 0400	 	 	 	STACK   ENDS            ;å †æ ˆæ®µå®šä¹‰
 	 	 	 	
 0000	 	 	 	DATA    SEGMENT
 0000  00	 	 	        KEY   DB 0      ;å­˜å‚¨æŒ‰ä¸‹é”®ç›˜çš„æ
	 	 	 	¬¡æ•°ï¼Œåˆå€¼ä¸º0
 0001  4F 4B 21	 	 	        MSG   DB "OK!"  ;å­˜å‚¨æŒ‰ä¸‹é”®ç›˜åŽç
	 	 	 	š„æç¤ºä¿¡æ¯
 = 0003	 	 	 	        LENGTH EQU $-MSG ;æç¤ºå­—ç¬¦é•¿åº¦
 0004	 	 	 	DATA    ENDS
 	 	 	 	
 0000	 	 	 	CODE    SEGMENT
 	 	 	 	        ASSUME CS:CODE, SS:STACK, DS:DATA
 0000	 	 	 	START: 
 0000  B8 ---- R	 	        MOV AX, STACK
 0003  8E D0	 	 	        MOV SS, AX
 0005  B8 ---- R	 	        MOV AX, DATA
 0008  8E D8	 	 	        MOV DS, AX
 	 	 	 	        ;ä¿å­˜åŽŸ09Hä¸­æ–­å†…å®¹
 000A  B8 0000	 	 	        MOV AX, 0
 000D  8E C0	 	 	        MOV ES, AX      ;ESç”¨æ¥å­˜æ”¾ä¸­æ–­å
	 	 	 	‘é‡è¡¨çš„æ®µåœ°å€(ç‰©ç†åœ°å€ï¼š00000H)
 000F  26: A1 0024	 	        MOV AX, ES:[24H];èŽ·å–09Hä¸­æ–­åç§»å
	 	 	 	œ°å€ï¼Œ[24H]å³ä¸º00036D,æ˜¯ä¸º09Håœ¨ä¸­æ–­å‘
	 	 	 	é‡è¡¨çš„é¦–åœ°å€
 0013  50	 	 	        PUSH AX
 0014  26: A1 0026	 	        MOV AX, ES:[26H];èŽ·å–09Hä¸­æ–­æ®µåœ°å
	 	 	 	€
 0018  50	 	 	        PUSH AX 
 	 	 	 	        ;å­˜å…¥æ–°ä¸­æ–­å†…å®¹KEYINTS
 0019  FA	 	 	        CLI             ;å±è”½å¤–éƒ¨ä¸­æ–­ï¼Œé
	 	 	 	˜²æ­¢å¯èƒ½å—åˆ°çš„å¹²æ‰°
 001A  B8 0045 R	 	        MOV AX, OFFSET KEYINTS
 001D  26: A3 0024	 	        MOV ES:[24H], AX
 0021  B8 ---- R	 	        MOV AX, SEG KEYINTS
 0024  26: A3 0026	 	        MOV ES:[26H], AX    
 0028  FB	 	 	        STI             ;å­˜å®ŒåŽæ‰“å¼€å¤–éƒ¨ä
	 	 	 	¸­æ–­å±è”½
 0029	 	 	 	AGAIN:  
 0029  9A 0083 ---- R	 	        CALL FAR PTR SHOW1  ;æ˜¾ç¤ºä¸€è½®å¤ªé˜³
	 	 	 	å›¾å½¢
 002E  80 3E 0000 R 0A	 	        CMP KEY, 10     ;åˆ¤æ–­æŒ‰é”®æ˜¯å¦æŒ‰ä
	 	 	 	¸‹10æ¬¡
 0033  72 F4	 	 	        JB AGAIN        ;é”®ç›˜æœªæŒ‰ä¸‹åæ¬¡ï
	 	 	 	¼Œåˆ™ç»§ç»­ä¸‹ä¸€è½®æ˜¾ç¤ºå¤ªé˜³å›¾å½¢
 	 	 	 	        ;è‹¥æŒ‰ä¸‹äº†åæ¬¡ï¼Œè¿›è¡Œå¤„ç†
 0035  FA	 	 	        CLI             ;å±è”½å¤–éƒ¨ä¸­æ–­ï¼Œå
	 	 	 	‡†å¤‡å°†åŽŸæœ‰ä¸­æ–­å‘é‡æ¢å¤åˆ°ä¸­æ–­å‘é‡
	 	 	 	è¡¨ä¸­
 The Microsoft MACRO Assembler , Version 1.27          	Page	1-2
	 	 	 	 	 	 	 	04-29-<4    


 0036  58	 	 	        POP AX
 0037  26: A3 0026	 	        MOV ES:[26H], AX
 003B  58	 	 	        POP AX
 003C  26: A3 0024	 	        MOV ES:[24H], AX
 0040  FB	 	 	        STI             ;æ‰“å¼€å¤–éƒ¨ä¸­æ–­
 	 	 	 	
 0041  B4 4C	 	 	        MOV AH, 4CH
 0043  CD 21	 	 	        INT 21H         ;è¿”å›žDOS
 	 	 	 	
 	 	 	 	;é”®ç›˜ä¸­æ–­å­ç¨‹åº
 0045	 	 	 	KEYINTS  PROC FAR
 0045  50	 	 	        PUSH AX
 0046  56	 	 	        PUSH SI
 0047  FB	 	 	        STI             ;åœ¨å­ç¨‹åºå†…æ‰“å¼€å
	 	 	 	¤–éƒ¨ä¸­æ–­
 0048  E4 60	 	 	        IN  AL, 60H     ;é€šè¿‡8255Açš„PAå£(PA
	 	 	 	å£åœ°å€ä¸º60H)è¯»å–é”®ç›˜æ‰«æç 
 004A  8A E0	 	 	        MOV AH, AL      ;ä»Ž8255Açš„PAå£è¯»å…¥
	 	 	 	é”®ç›˜æ‰«æç ï¼Œå°†å…¶å­˜å…¥AH
 004C  E4 61	 	 	        IN  AL, 61H     ;è¯»å…¥PBå£çš„å½“å‰å€
	 	 	 	¼
 	 	 	 	        ;å®Œæˆåœ¨PBï¼ˆ7ï¼‰å£çš„ä¸€æ¬¡æ­£è„‰å†
	 	 	 	²è¾“å‡ºï¼Œä»¥é€šçŸ¥é”®ç›˜æŽ§åˆ¶å™¨å·²ç»å¤„ç†ä
	 	 	 	º†ä¸­æ–­ã€‚
 004E  0C 80	 	 	        OR  AL, 80H     ;PBï¼ˆ7ï¼‰ç½®1
 0050  E6 61	 	 	        OUT 61H, AL
 0052  24 7F	 	 	        AND AL, 7FH     ;PBï¼ˆ7ï¼‰ç½®0ï¼Œ
 0054  E6 61	 	 	        OUT 61H, AL
 	 	 	 	
 0056  F6 C4 80	 	 	        TEST AH, 80H    ;æ£€æµ‹é”®ç›˜æ‰«æç ç
	 	 	 	š„æœ€é«˜ä½æ˜¯å¦ä¸º1
 0059  75 0A	 	 	        JNZ GO          ;è‹¥æœ€é«˜ä½ä¸º1ï¼Œè¯´
	 	 	 	æ˜Žæ­¤æ—¶é”®ç›˜é‡Šæ”¾ï¼Œè·³è½¬åˆ°å­ç¨‹åºå‡ºå
	 	 	 	£å¤„
 005B  FB	 	 	        STI
 005C  FE 06 0000 R	 	        INC KEY         ;è‹¥æœ€é«˜ä½ä¸º0ï¼Œè¯´
	 	 	 	æ˜Žæ­¤æ—¶é”®ç›˜æŒ‰ä¸‹ï¼Œç»™è®¡æ•°å™¨åŠ ä¸€
 0060  9A 00C1 ---- R	 	        CALL FAR PTR SHOW2  ;å¹¶æ˜¾ç¤ºæç¤ºä¿¡
	 	 	 	æ¯
 0065	 	 	 	GO:
 0065  B0 20	 	 	        MOV AL, 20H
 0067  E6 20	 	 	        OUT 20H, AL     ;ç»™8259Açš„OCW1å‘å‡ºè
	 	 	 	¡¨ç¤ºä¸­æ–­ç»“æŸçš„EOIå‘½ä»¤
 0069  5E	 	 	        POP SI
 006A  58	 	 	        POP AX
 006B  CF	 	 	        IRET
 006C	 	 	 	KEYINTS  ENDP
 	 	 	 	
 	 	 	 	;å»¶æ—¶1så­ç¨‹åº
 006C	 	 	 	DELAYS	PROC	
 	 	 	 	        ;åŽ‹æ ˆ
 006C  52	 	 	 	PUSH DX
 006D  51	 	 	 	PUSH CX
 The Microsoft MACRO Assembler , Version 1.27          	Page	1-3
	 	 	 	 	 	 	 	04-29-<4    


 006E  53	 	 	        PUSH BX
 006F  50	 	 	 	PUSH AX
 	 	 	 	        ;ä¸­æ–­è°ƒç”¨å»¶æ—¶
 0070  B4 2C	 	 	 	MOV AH, 2CH
 0072  CD 21	 	 	 	INT 21H	        ;DOSè°ƒç”¨ç³»ç»Ÿæ—¶é—´
 0074  8A FE	 	 	 	MOV BH, DH	;å­˜å‚¨å½“å‰ç§’æ•°
 0076	 	 	 	BEGIN:
 0076  CD 21	 	 	 	INT 21H	        ;è°ƒç”¨ç³»ç»Ÿæ—¶é—´
 0078  3A FE	 	 	 	CMP BH, DH	;æ¯”è¾ƒå½“å‰æ—¶é—´ä¸Žä
	 	 	 	¸Šæ¬¡è°ƒç”¨çš„æ—¶é—´æ˜¯å¦å˜åŒ–
 007A  75 02	 	 	 	JNE NEXT	;è‹¥æœ‰å˜åŒ–ï¼Œåˆ™å®Œæ
	 	 	 	ˆå»¶æ—¶ï¼Œé€€å‡ºç¨‹åº
 007C  EB F8	 	 	 	JMP BEGIN	;è‹¥æ— å˜åŒ–ï¼Œåˆ™ç»§ç
	 	 	 	»­è°ƒç”¨ç³»ç»Ÿæ—¶é—´
 007E	 	 	 	NEXT:
 	 	 	 	        ;å¼¹å‡º
 007E  58	 	 	 	POP AX
 007F  5B	 	 	        POP BX
 0080  59	 	 	 	POP CX
 0081  5A	 	 	 	POP DX
 0082  C3	 	 	 	RET
 0083	 	 	 	DELAYS	ENDP
 	 	 	 	
 	 	 	 	;æ˜¾ç¤ºå¤ªé˜³å›¾å½¢çš„å­ç¨‹åº
 0083	 	 	 	SHOW1   PROC FAR   
 	 	 	 	        ;åŽ‹æ ˆ 
 0083  50	 	 	        PUSH AX
 0084  53	 	 	        PUSH BX
 0085  51	 	 	        PUSH CX
 0086  52	 	 	        PUSH DX
 	 	 	 	        ;æ¯è½®æ˜¾ç¤ºå¤ªé˜³        
 0087  B4 0F	 	 	        MOV AH, 15  
 0089  CD 10	 	 	        INT 10H      ;è¯»å–å½“å‰æ˜¾ç¤ºçŠ¶æ€
 008B  B4 00	 	 	        MOV AH, 0
 008D  CD 10	 	 	        INT 10H      ;è®¾ç½®æ˜¾ç¤ºæ–¹å¼
 008F  B9 0001	 	 	        MOV CX, 1    ;è¦æ˜¾ç¤ºçš„å­—ç¬¦æ•°
 0092  BA 0000	 	 	        MOV DX, 0    ;è®¾ç½®å…‰æ ‡èµ·å§‹ä½ç½®ä
	 	 	 	¸ºè¡Œå·ä¸º0ï¼Œåˆ—å·ä¸º0
 0095	 	 	 	REPEAT:
 0095  80 3E 0000 R 0A	 	        CMP KEY, 10
 009A  73 20	 	 	        JAE EXIT     ;è‹¥KEYè¾¾åˆ°10ï¼Œè½¬è‡³EX
	 	 	 	IT
 	 	 	 	        ;KEYå°äºŽ10çš„æƒ…å†µ
 009C  B4 02	 	 	        MOV AH, 2    
 009E  CD 10	 	 	        INT 10H      ;è®¾ç½®å…‰æ ‡ä½ç½®
 00A0  B0 0F	 	 	        MOV AL, 0FH  ;å¤ªé˜³å›¾å½¢çš„ASCIIç 
 00A2  B9 0001	 	 	        MOV CX, 1    ;è¦æ˜¾ç¤ºçš„å­—ç¬¦æ•°
 00A5  B4 0A	 	 	        MOV AH, 10   
 00A7  CD 10	 	 	        INT 10H      ;æ˜¾ç¤ºå•ä¸ªå¤ªé˜³å›¾å½¢
 00A9  E8 006C R	 	        CALL DELAYS  ;å»¶æ—¶ä¸€ç§’
 00AC  2A C0	 	 	        SUB AL, AL
 00AE  B4 06	 	 	        MOV AH, 6       
 00B0  CD 10	 	 	        INT 10H      ;æ¸…å±
 The Microsoft MACRO Assembler , Version 1.27          	Page	1-4
	 	 	 	 	 	 	 	04-29-<4    


 00B2  FE C6	 	 	        INC DH       ;è¡Œå·+1
 00B4  80 C2 02	 	 	        ADD DL, 2    ;åˆ—å·+2
 00B7  80 FE 19	 	 	        CMP DH, 25    
 00BA  72 D9	 	 	        JB REPEAT    ;å¦‚æžœæ²¡åˆ°25è¡Œï¼Œåˆ™è·
	 	 	 	³è½¬åˆ°REPEATæ›´æ–°å…‰æ ‡ä½ç½®ï¼›åˆ°äº†25è¡Œåˆ
	 	 	 	™é€€å‡ºå­ç¨‹åº
 00BC	 	 	 	EXIT:
 	 	 	 	        ;å¼¹å‡º
 00BC  5A	 	 	        POP DX
 00BD  59	 	 	        POP CX
 00BE  5B	 	 	        POP BX
 00BF  58	 	 	        POP AX
 00C0  CB	 	 	        RET
 00C1	 	 	 	SHOW1   ENDP
 	 	 	 	
 	 	 	 	;æ˜¾ç¤ºæç¤ºä¿¡æ¯çš„å­ç¨‹åº
 00C1	 	 	 	SHOW2   PROC FAR    
 	 	 	 	        ;åŽ‹æ ˆ 
 00C1  56	 	 	        PUSH SI
 00C2  52	 	 	        PUSH DX
 00C3  51	 	 	        PUSH CX
 00C4  53	 	 	        PUSH BX
 00C5  50	 	 	        PUSH AX
 	 	 	 	
 00C6  8D 36 0001 R	 	        LEA SI, MSG   ;å°†å­—ç¬¦ä¸²MSGçš„é¦–åœ°
	 	 	 	å€è£…å…¥SI
 	 	 	 	        ;è¯»å–å½“å‰å…‰æ ‡ä½ç½®
 00CA  B4 03	 	 	        MOV AH, 3
 00CC  B7 00	 	 	        MOV BH, 0
 00CE  CD 10	 	 	        INT 10H       
 	 	 	 	
 00D0  FE C2	 	 	        INC DL          ;åˆ—å·+1
 00D2  B4 02	 	 	        MOV AH, 2
 00D4  CD 10	 	 	        INT 10H         ;å°†å…‰æ ‡è®¾åœ¨ä¸‹ä¸€ä
	 	 	 	¸ªä½ç½®ï¼Œé¿å…è¦†ç›–åŽŸå­—ç¬¦
 00D6  B9 0000	 	 	        MOV CX, LENGTH  ;å°†å­—ç¬¦ä¸²MSGçš„é•¿å
	 	 	 	º¦è£…å…¥CX
 E r r o r   ---	27:Operand was expected          
 00D9	 	 	 	NEXTC:
 00D9  AC	 	 	        LODSB           ;ä»Žå†…å­˜ä¸­çš„SIæŒ‡å
	 	 	 	‘çš„ä½ç½®è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶å°†å…¶å­˜å…¥A
	 	 	 	Lå¯„å­˜å™¨ï¼ŒåŒæ—¶SIå¯„å­˜å™¨é€’å¢žã€
 	 	 	 	
 00DA  B4 0E	 	 	        MOV AH, 0EH     ;è®¾ç½® AH å¯„å­˜å™¨ä¸º
	 	 	 	 0EHï¼Œè¡¨ç¤ºæ˜¾ç¤ºå­—ç¬¦å’Œå±žæ€§ã€‚ 
 00DC  BB 0001	 	 	        MOV BX, 1
 00DF  CD 10	 	 	        INT 10H
 00E1  E2 F6	 	 	        LOOP NEXTC
 	 	 	 	        ;å¼¹å‡º 
 00E3  58	 	 	        POP AX
 00E4  5B	 	 	        POP BX
 00E5  59	 	 	        POP CX
 00E6  5A	 	 	        POP DX
 The Microsoft MACRO Assembler , Version 1.27          	Page	1-5
	 	 	 	 	 	 	 	04-29-<4    


 00E7  5E	 	 	        POP SI
 00E8  CB	 	 	        RET
 00E9	 	 	 	SHOW2   ENDP
 	 	 	 	
 00E9	 	 	 	CODE    ENDS
 	 	 	 	        END START

 The Microsoft MACRO Assembler , Version 1.27          	Page	Symbols
	 	 	 	-1
	 	 	 	 	 	 	 	04-29-<4    


Segments and groups:

	 	N a m e	 	 	Size	align	combine	class

CODE . . . . . . . . . . . . . .	00E9	PARA  	NONE	
DATA . . . . . . . . . . . . . .	0004	PARA  	NONE	
STACK. . . . . . . . . . . . . .	0400	PARA  	NONE	

Symbols:            

	 	N a m e	 	 	Type	Value	Attr         

AGAIN. . . . . . . . . . . . . .	L NEAR 	0029	CODE
BEGIN. . . . . . . . . . . . . .	L NEAR 	0076	CODE
DELAYS . . . . . . . . . . . . .	N PROC	006C	CODE	Length =0017
EXIT . . . . . . . . . . . . . .	L NEAR 	00BC	CODE
GO . . . . . . . . . . . . . . .	L NEAR 	0065	CODE
KEY. . . . . . . . . . . . . . .	L BYTE 	0000	DATA
KEYINTS. . . . . . . . . . . . .	F PROC	0045	CODE	Length =0027
LENGTH . . . . . . . . . . . . .	Number	0003	
MSG. . . . . . . . . . . . . . .	L BYTE 	0001	DATA
NEXT . . . . . . . . . . . . . .	L NEAR 	007E	CODE
NEXTC. . . . . . . . . . . . . .	L NEAR 	00D9	CODE
REPEAT . . . . . . . . . . . . .	L NEAR 	0095	CODE
SHOW1. . . . . . . . . . . . . .	F PROC	0083	CODE	Length =003E
SHOW2. . . . . . . . . . . . . .	F PROC	00C1	CODE	Length =0028
START. . . . . . . . . . . . . .	L NEAR 	0000	CODE
STK. . . . . . . . . . . . . . .	L WORD 	0000	STACK	Length =0200

Warning Severe
Errors	Errors 
0	1
